<!DOCTYPE html>
<html>
<head>
  <title>Token Salience Visualization</title>
  <style>
    .token {
      display: inline-block;
      padding: 4px 8px;
      margin: 4px;
      background-color: #f0f0f0;
      border-radius: 4px;
      cursor: pointer;
    }

    .token.highlight {
      background-color: #ffff00;
    }

    #tooltip {
      display: none;
      position: absolute;
      background-color: #000;
      color: #fff;
      padding: 8px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="token-container"></div>
  <div id="tooltip"></div>

  <script>
    function renderTokens(data, tokens) {
      const tokenContainer = document.getElementById('token-container');
      const tooltip = document.getElementById('tooltip');

      // Clear any existing tokens
      tokenContainer.innerHTML = '';

      // Create a span element for each token
      tokens.forEach((token, index) => {
        const tokenElement = document.createElement('span');
        tokenElement.textContent = token;
        tokenElement.classList.add('token');
        tokenElement.addEventListener('mouseover', () => {
          highlightAffectedTokens(index, data, tokens);
          showTooltip(token);
        });
        tokenElement.addEventListener('mouseout', () => {
          removeHighlight();
          hideTooltip();
        });
        tokenContainer.appendChild(tokenElement);
      });
    }

    function highlightAffectedTokens(tokenIndex, data, tokens) {
      const tokenElements = document.querySelectorAll('.token');
      tokenElements.forEach((element, index) => {
        if (index < tokenIndex) {
          const salienceScore = data[tokenIndex][index];
          element.classList.toggle('highlight', salienceScore > 0);
          element.style.backgroundColor = `rgba(255, 255, 0, ${salienceScore})`;
        } else {
          element.classList.remove('highlight');
          element.style.backgroundColor = '';
        }
      });
    }

    function removeHighlight() {
      const tokenElements = document.querySelectorAll('.token');
      tokenElements.forEach(element => {
        element.classList.remove('highlight');
        element.style.backgroundColor = '';
      });
    }

    function showTooltip(token) {
      const tooltip = document.getElementById('tooltip');
      tooltip.textContent = `Hovered Token: ${token}`;
      tooltip.style.display = 'block';
    }

    function hideTooltip() {
      const tooltip = document.getElementById('tooltip');
      tooltip.style.display = 'none';
    }

    // Example API data (non-square matrix)
    const apiData = [
      [0.0, 0.8],
      [0.6, 0.0, 0.4],
      [0.3, 0.7, 0.0, 0.2],
      // ...
    ];

    const tokens = ['token1', 'token2', 'token3', 'token4']; // Array of tokens corresponding to the indices

    renderTokens(apiData, tokens);
  </script>
</body>
</html>